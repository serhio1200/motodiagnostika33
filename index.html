<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Motopodbor.ru PRO - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥–±–æ—Ä –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Motopodbor.ru PRO">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6366F1">
    <meta name="description" content="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ø–æ–¥–±–æ—Ä –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIk1vdG9wb2Rib3IucnUgUFJPIiwKICAic2hvcnRfbmFtZSI6ICJNb3RvcG9kYm9yIiwKICAiZGVzY3JpcHRpb24iOiAiUHJvZmVzc2lvbmFsIG1vdG9yY3ljbGUgZGlhZ25vc3RpY3MgYW5kIHNlbGVjdGlvbiIsCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMTExODI3IiwKICAidGhlbWVfY29sb3IiOiAiIzYzNjZGMSIsCiAgIm9yaWVudGF0aW9uIjogImFueSIsCiAgInNjb3BlIjogIi4iLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSEJ5WlhObGNuWmxRWE53WldOMFVtRjBhVzg5SW5oTmFXNVpUV2x1SUcxbFpYUWlJSFpwWlhkQ2IzZzlJakFnTUNBek5UQWdNelV3SWo0TkNpQWdJQ0E4YzNabklIZHBaSFJvUFNJeE1EQWxJaUJvWldsbmFIUTlJakV3TUNVaUlHWnBiR3c5SW1Kc1lXTnJJaUF2UGp3dmMzWm5QZz09IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIQnlaWE5sY25abFFYTndaV04wVW1GMGFXODlJbmhOYVc1WlRXbHVJRzFsWlhRaUlIWnBaWGRDYjNnOUlqQWdNQ0F6TlRBZ016VXdJajROQ2lBZ0lDQThjM1puSUhkcFpIUm9QU0l4TURBbElpQm9aV2xuYUhROUlqRXdNQ1VpSUdacGJHdzlJbUpzWVdOcklpQXZQand2YzNablBnPT0iLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0KICBdLAogICJzY3JlZW5zaG90cyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSEJ5WlhObGNuWmxRWE53WldOMFVtRjBhVzg5SW5oTmFXNVpUV2x1SUcxbFpYUWlJSFpwWlhkQ2IzZzlJakFnTUNBek5UQWdNelV3SWo0TkNpQWdJQ0E4YzNabklIZHBaSFJvUFNJeE1EQWxJaUJvWldsbmFIUTlJakV3TUNVaUlHWnBiR3c5SW1Kc1lXTnJJaUF2UGp3dmMzWm5QZz09IiwKICAgICAgInNpemVzIjogIjExNzB4MjUzMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0KICBdLAogICJmZWF0dXJlcyI6IFsKICAgICJjb3NzIiwKICAgICJ3ZWJzaGFyZSIKICBdLAogICJwcmVmZXJyZWRfcmVsYXRlZF9hcHBsaWNhdGlvbnMiOiBbCiAgICB7CiAgICAgICJpZCI6ICJodHRwczovL21vdG9wb2Rib3IucnUiCiAgICB9CiAgXQp9">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM2MzY2RjEiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAxMk0xMiA2TDEyIDE4TTYgMTJIMThaIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+Cjwvc3ZnPgo=">
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // Enhanced Service Worker with better caching
                const swContent = `
                    const CACHE_NAME = 'motopodbor-pro-v2.7.1';
                    const urlsToCache = [
                        '/',
                        '/index.html',
                        './?utm_source=pwa',
                        './?utm_source=homescreen'
                    ];

                    self.addEventListener('install', function(event) {
                        console.log('Service Worker installing');
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(function(cache) {
                                    console.log('Opened cache');
                                    return cache.addAll(urlsToCache);
                                })
                                .then(() => self.skipWaiting())
                        );
                    });

                    self.addEventListener('activate', function(event) {
                        console.log('Service Worker activating');
                        event.waitUntil(
                            caches.keys().then(function(cacheNames) {
                                return Promise.all(
                                    cacheNames.map(function(cacheName) {
                                        if (cacheName !== CACHE_NAME) {
                                            console.log('Deleting old cache:', cacheName);
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            }).then(() => self.clients.claim())
                        );
                    });

                    self.addEventListener('fetch', function(event) {
                        if (event.request.method !== 'GET') return;
                        
                        event.respondWith(
                            caches.match(event.request)
                                .then(function(response) {
                                    if (response) {
                                        return response;
                                    }
                                    
                                    return fetch(event.request).then(
                                        function(response) {
                                            if(!response || response.status !== 200 || response.type !== 'basic') {
                                                return response;
                                            }
                                            
                                            var responseToCache = response.clone();
                                            
                                            caches.open(CACHE_NAME)
                                                .then(function(cache) {
                                                    cache.put(event.request, responseToCache);
                                                });
                                            
                                            return response;
                                        }
                                    ).catch(function(error) {
                                        console.log('Fetch failed; returning offline page instead.', error);
                                        // You can return a custom offline page here
                                    });
                                }
                            )
                        );
                    });

                    self.addEventListener('message', function(event) {
                        if (event.data && event.data.type === 'SKIP_WAITING') {
                            self.skipWaiting();
                        }
                    });

                    // Background sync for offline data
                    self.addEventListener('sync', function(event) {
                        if (event.tag === 'background-sync') {
                            console.log('Background sync triggered');
                            event.waitUntil(doBackgroundSync());
                        }
                    });

                    async function doBackgroundSync() {
                        // Implement background sync logic here
                        console.log('Performing background sync');
                    }
                `;

                const blob = new Blob([swContent], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);

                navigator.serviceWorker.register(swUrl)
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('New service worker found:', newWorker);
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('New content is available; please refresh.');
                                    // Show update notification to user
                                    if (window.app && window.app.showToast) {
                                        window.app.showToast('–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ! –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.', 'info');
                                    }
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }

        // PWA Installation Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installBtn = document.getElementById('installBtn');
            if (installBtn) {
                installBtn.style.display = 'block';
                installBtn.addEventListener('click', installPWA);
            }
            
            // Auto-show install prompt after 30 seconds for new users
            setTimeout(() => {
                if (deferredPrompt && !localStorage.getItem('pwa_install_shown')) {
                    showInstallPrompt();
                    localStorage.setItem('pwa_install_shown', 'true');
                }
            }, 30000);
        });

        function installPWA() {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                    if (window.app && window.app.showToast) {
                        window.app.showToast('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è...', 'success');
                    }
                    
                    // Track installation
                    localStorage.setItem('pwa_installed', 'true');
                    localStorage.setItem('pwa_install_date', new Date().toISOString());
                } else {
                    console.log('User dismissed the install prompt');
                    if (window.app && window.app.showToast) {
                        window.app.showToast('–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞', 'warning');
                    }
                }
                deferredPrompt = null;
                
                // Hide install button after choice
                const installBtn = document.getElementById('installBtn');
                if (installBtn) {
                    installBtn.style.display = 'none';
                }
            });
        }

        function showInstallPrompt() {
            if (!deferredPrompt) return;
            
            if (window.app && window.app.showToast) {
                const toastAction = window.app.showToast(
                    '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞!', 
                    'info',
                    5000
                );
                
                // Add install button to toast
                setTimeout(() => {
                    installPWA();
                }, 2000);
            }
        }

        // Detect if app is launched from home screen
        window.addEventListener('load', () => {
            if (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
                document.body.classList.add('pwa-launched');
                console.log('Launched from home screen');
                
                // Track PWA usage
                localStorage.setItem('pwa_launched', 'true');
                localStorage.setItem('pwa_launch_count', parseInt(localStorage.getItem('pwa_launch_count') || '0') + 1);
            }
        });

        // Network status detection
        window.addEventListener('online', () => {
            if (window.app && window.app.showToast) {
                window.app.showToast('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
            }
            document.body.classList.remove('offline');
        });

        window.addEventListener('offline', () => {
            if (window.app && window.app.showToast) {
                window.app.showToast('–†–∞–±–æ—Ç–∞ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ', 'warning');
            }
            document.body.classList.add('offline');
        });

        // Initialize online status
        if (!navigator.onLine) {
            document.body.classList.add('offline');
        }
    </script>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Add PWA-specific styles */
        .pwa-launched .app-header {
            padding-top: max(20px, env(safe-area-inset-top));
        }
        
        .offline .app-header {
            background: linear-gradient(135deg, #6B7280, #4B5563);
        }
        
        .offline .nav-tab.active {
            color: #6B7280;
            border-bottom-color: #6B7280;
        }
        
        #installBtn {
            background: linear-gradient(135deg, #10B981, #059669);
            margin-top: 10px;
            animation: pulse 2s infinite;
        }
        
        #installBtn.installed {
            background: linear-gradient(135deg, #6B7280, #4B5563);
            animation: none;
        }
        
        .network-status {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10B981;
            z-index: 10000;
            border: 2px solid var(--card-bg);
        }
        
        .network-status.offline {
            background: #EF4444;
        }
        
        .pwa-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--primary-color);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 600;
        }
        
        /* Rest of your existing CSS remains the same */
        :root {--primary-color: #6366F1;--primary-dark: #4F46E5;--secondary-color: #10B981;--danger-color: #EF4444;--warning-color: #F59E0B;--success-color: #10B981;--text-color: #1F2937;--text-light: #6B7280;--bg-color: #F9FAFB;--card-bg: #ffffff;--border-color: #E5E7EB;--shadow: 0 4px 20px rgba(0,0,0,0.08);--shadow-hover: 0 8px 30px rgba(0,0,0,0.12);--safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);--safe-area-inset-top: env(safe-area-inset-top, 0px);}
        [data-theme="dark"] {--primary-color: #818CF8;--primary-dark: #6366F1;--secondary-color: #34D399;--danger-color: #F87171;--warning-color: #FBBF24;--success-color: #34D399;--text-color: #F9FAFB;--text-light: #D1D5DB;--bg-color: #111827;--card-bg: #1F2937;--border-color: #374151;--shadow: 0 4px 20px rgba(0,0,0,0.25);--shadow-hover: 0 8px 30px rgba(0,0,0,0.35);}
        * {box-sizing: border-box;margin: 0;padding: 0;-webkit-tap-highlight-color: transparent;}
        body {font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;background: var(--bg-color);color: var(--text-color);line-height: 1.6;min-height: 100vh;padding: 0;margin: 0;transition: background-color 0.3s ease, color 0.3s ease;padding-bottom: var(--safe-area-inset-bottom);padding-top: var(--safe-area-inset-top);}
        .app-container {max-width: 100%;margin: 0 auto;background: var(--bg-color);min-height: 100vh;position: relative;}
        .app-header {background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));color: white;padding: 20px 16px;text-align: center;position: sticky;top: 0;z-index: 100;box-shadow: 0 4px 20px rgba(0,0,0,0.15);padding-top: calc(20px + var(--safe-area-inset-top));}
        .app-header h1 {font-size: 1.5rem;margin-bottom: 6px;font-weight: 700;letter-spacing: -0.025em;}
        .app-header p {opacity: 0.9;font-size: 0.9rem;font-weight: 400;}
        .nav-tabs {display: flex;background: var(--card-bg);border-bottom: 1px solid var(--border-color);position: sticky;top: 0;z-index: 99;padding: 0 4px;overflow-x: auto;-webkit-overflow-scrolling: touch;scrollbar-width: none;}
        .nav-tabs::-webkit-scrollbar { display: none; }
        .nav-tab {flex: 1;min-width: 70px;background: none;border: none;padding: 14px 6px;text-align: center;font-weight: 600;font-size: 0.7rem;color: var(--text-light);cursor: pointer;transition: all 0.3s ease;border-bottom: 3px solid transparent;border-radius: 0;margin: 0 1px;white-space: nowrap;display: flex;flex-direction: column;align-items: center;gap: 4px;}
        .nav-tab.active {color: var(--primary-color);border-bottom-color: var(--primary-color);background: rgba(99, 102, 241, 0.05);}
        .nav-tab:active { background: rgba(99, 102, 241, 0.1); transform: scale(0.98); }
        .nav-tab .tab-icon { font-size: 1.1rem; margin-bottom: 2px; }
        .nav-tab .tab-text { font-size: 0.65rem; line-height: 1.2; }
        .tab-content {display: none;padding: 20px 16px;animation: fadeIn 0.4s ease;padding-bottom: calc(20px + var(--safe-area-inset-bottom));}
        .tab-content.active { display: block; }
        @keyframes fadeIn {from { opacity: 0; transform: translateY(15px); }to { opacity: 1; transform: translateY(0); }}
        .card {background: var(--card-bg);border-radius: 16px;padding: 20px;margin-bottom: 20px;box-shadow: var(--shadow);border: 1px solid var(--border-color);transition: transform 0.3s ease, box-shadow 0.3s ease;}
        .card:hover { box-shadow: var(--shadow-hover); }
        .card:active { transform: scale(0.995); }
        .section-title {font-size: 1.1rem;font-weight: 700;margin-bottom: 16px;color: var(--primary-color);display: flex;align-items: center;gap: 8px;letter-spacing: -0.025em;}
        .form-group { margin-bottom: 20px; }
        .form-row {display: grid;grid-template-columns: 1fr 1fr;gap: 16px;margin-bottom: 16px;}
        label {display: block;margin-bottom: 8px;font-weight: 600;color: var(--text-color);font-size: 0.9rem;}
        input, select, textarea {width: 100%;padding: 14px;border: 2px solid var(--border-color);border-radius: 12px;font-size: 16px;background: var(--card-bg);color: var(--text-color);transition: all 0.3s ease;font-family: inherit;-webkit-appearance: none;}
        input:focus, select:focus, textarea:focus {border-color: var(--primary-color);outline: none;box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);transform: translateY(-2px);}
        .mileage-row {display: flex;align-items: center;gap: 12px;}
        .mileage-input-group {flex: 1;display: flex;flex-direction: column;gap: 6px;}
        .mileage-input-group input {width: 100%;padding: 14px;border: 2px solid var(--border-color);border-radius: 12px;font-size: 16px;background: var(--card-bg);color: var(--text-color);transition: all 0.3s ease;}
        .mileage-input-group input:focus {border-color: var(--primary-color);outline: none;box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);}
        .mileage-label {font-size: 0.75rem;color: var(--text-light);text-align: center;font-weight: 500;}
        .mileage-separator {color: var(--primary-color);font-size: 1.2rem;font-weight: bold;padding: 0 8px;}
        @media (max-width: 480px) {.mileage-row {flex-direction: column;gap: 8px;}.mileage-separator {transform: rotate(90deg);padding: 4px 0;}}
        .btn {background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));color: white;border: none;border-radius: 12px;padding: 16px 20px;font-size: 1rem;font-weight: 600;cursor: pointer;transition: all 0.3s ease;text-align: center;display: block;width: 100%;position: relative;overflow: hidden;}
        .btn::before {content: '';position: absolute;top: 0; left: -100%;width: 100%; height: 100%;background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);transition: left 0.5s;}
        .btn:hover::before { left: 100%; }
        .btn:active { transform: scale(0.98); }
        .btn-secondary { background: linear-gradient(135deg, var(--secondary-color), #059669); }
        .btn-warning { background: linear-gradient(135deg, var(--warning-color), #D97706); }
        .btn-danger { background: linear-gradient(135deg, var(--danger-color), #DC2626); }
        .btn-success { background: linear-gradient(135deg, var(--success-color), #059669); }
        .progress-container { margin: 20px 0; }
        .progress-bar {height: 8px; background: var(--border-color);border-radius: 4px; overflow: hidden; margin-bottom: 10px;box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);}
        .progress-fill {height: 100%;background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));width: 0%; transition: width 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);border-radius: 4px; position: relative; overflow: hidden;}
        .progress-fill::after {content: ''; position: absolute; top: 0; left: -100%;width: 100%; height: 100%;background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);animation: shimmer 2s infinite;}
        @keyframes shimmer { 0% { left: -100%; } 100% { left: 100%; } }
        .progress-text { text-align: center; font-size: 0.8rem; color: var(--text-light); font-weight: 500; }
        .alert {padding: 16px; border-radius: 12px; margin: 16px 0; font-weight: 500;animation: slideIn 0.4s ease; border-left: 4px solid;}
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px);} to { opacity: 1; transform: translateX(0);} }
        .alert-success { background: rgba(16,185,129,0.1); color: var(--success-color); border-left-color: var(--success-color); }
        .alert-info { background: rgba(99,102,241,0.1); color: var(--primary-color); border-left-color: var(--primary-color); }
        .alert-warning { background: rgba(245,158,11,0.1); color: var(--warning-color); border-left-color: var(--warning-color); }
        .output-container {background: var(--card-bg); border-radius: 12px; padding: 20px; margin-top: 20px;border: 1px solid var(--border-color); white-space: pre-wrap;font-family: 'JetBrains Mono','Fira Code', monospace; font-size: 0.85rem; line-height: 1.6;max-height: 400px; overflow-y: auto; transition: all 0.3s ease;}
        .output-container:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(99,102,241,0.1); }
        .search-box { position: relative; margin-bottom: 20px; }
        .search-box input { padding-left: 44px; }
        .search-icon {position: absolute; left: 14px; top: 50%; transform: translateY(-50%);color: var(--text-light); z-index: 2;}
        .reports-list { max-height: 500px; overflow-y: auto; }
        .report-item {background: var(--card-bg); border-radius: 14px; padding: 16px; margin-bottom: 10px;border: 1px solid var(--border-color); transition: all 0.3s ease; cursor: pointer;}
        .report-item:hover { transform: translateY(-3px); box-shadow: var(--shadow-hover); }
        .report-item:active { transform: scale(0.99); }
        .report-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .report-title { font-weight: 700; font-size: 1rem; color: var(--text-color); }
        .report-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.8rem; color: var(--text-light); }
        .report-actions { display: flex; gap: 6px; }
        .action-btn { padding: 6px 10px; border: none; border-radius: 8px; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease; font-weight: 600; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin: 20px 0; }
        .stat-card {background: var(--card-bg); border-radius: 14px; padding: 16px; text-align: center;box-shadow: var(--shadow); border: 1px solid var(--border-color); transition: all 0.3s ease;}
        .stat-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-hover); }
        .stat-value { font-size: 1.5rem; font-weight: 800; color: var(--primary-color); margin: 6px 0; letter-spacing: -0.025em; }
        .stat-label { font-size: 0.8rem; color: var(--text-light); font-weight: 500; }
        .grid-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 16px 0; }
        .grid-btn {background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px;padding: 8px 4px; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease;}
        .grid-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        @media (max-width: 768px) {.form-row { grid-template-columns: 1fr; }.nav-tab { font-size: 0.65rem; padding: 12px 4px; }.nav-tab .tab-icon { font-size: 1rem; }.stats-grid { grid-template-columns: 1fr; }.tab-content { padding: 16px 12px; }.card { padding: 16px; border-radius: 14px; }.app-header { padding: 16px 12px; padding-top: calc(16px + var(--safe-area-inset-top)); }.app-header h1 { font-size: 1.3rem; }.section-title { font-size: 1rem; }.btn { padding: 14px 16px; font-size: 0.95rem; }}
        @media (max-width: 480px) {.app-header h1 { font-size: 1.2rem; }.nav-tab .tab-text { font-size: 0.6rem; }}
        @media (max-width: 380px) {.nav-tabs { padding: 0 2px; }.nav-tab { min-width: 60px; padding: 8px 1px; }.nav-tab .tab-icon { font-size: 0.9rem; }.nav-tab .tab-text { font-size: 0.55rem; }}
        .text-center { text-align: center; }
        .mt-10 { margin-top: 10px; }
        .mt-20 { margin-top: 20px; }
        .mb-10 { margin-bottom: 10px; }
        .mb-20 { margin-bottom: 20px; }
        .hidden { display: none !important; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-10 { gap: 10px; }
        .scroll-to-top {position: fixed; bottom: 80px; right: 16px; width: 50px; height: 50px; border-radius: 50%;background: var(--primary-color); color: white; border: none; font-size: 20px; cursor: pointer;box-shadow: 0 4px 20px rgba(0,0,0,0.15); display: none; z-index: 1000; transition: all 0.3s ease;align-items: center; justify-content: center;}
        .scroll-to-top.visible { display: flex; }
        .scroll-to-top:active { transform: scale(0.95); }
        .settings-group { margin-bottom: 24px; }
        .settings-label { font-weight: 600; margin-bottom: 10px; color: var(--text-color); font-size: 0.95rem; }
        .settings-description { font-size: 0.8rem; color: var(--text-light); margin-bottom: 14px; }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--border-color); transition: .4s; border-radius: 34px; }
        .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background: white; transition: .4s; border-radius: 50%; }
        input:checked + .toggle-slider { background: var(--primary-color); }
        input:checked + .toggle-slider:before { transform: translateX(24px); }
        .toggle-container { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px solid var(--border-color); }
        .toggle-label { font-weight: 500; color: var(--text-color); }
        .inspection-fields {background: rgba(99, 102, 241, 0.05); border-radius: 12px; padding: 16px; margin-top: 14px; border: 2px dashed var(--primary-color);}
        .inspection-item {background: var(--card-bg); border-radius: 12px; padding: 16px; margin-bottom: 14px;border: 1px solid var(--border-color); transition: all 0.3s ease; position: relative;}
        .inspection-item.urgent { border-left: 4px solid var(--warning-color); }
        .inspection-item.completed { opacity: 0.7; background: rgba(16, 185, 129, 0.05); }
        .inspection-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .inspection-title { font-weight: 700; font-size: 1rem; color: var(--text-color); }
        .inspection-date {font-size: 0.85rem; color: var(--text-light); background: var(--primary-color); color: white;padding: 4px 8px; border-radius: 16px; font-weight: 600;}
        .inspection-details { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.8rem; margin-bottom: 14px; }
        .inspection-actions { display: flex; gap: 6px; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: 600; margin-right: 6px; margin-bottom: 6px; }
        .badge-warning { background: rgba(245,158,11,0.1); color: var(--warning-color); }
        .badge-success { background: rgba(16,185,129,0.1); color: var(--success-color); }
        .badge-info { background: rgba(99,102,241,0.1); color: var(--primary-color); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%{ transform: scale(1);} 50%{ transform: scale(1.05);} 100%{ transform: scale(1);} }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%,100%{ transform: translateX(0);} 25%{ transform: translateX(-6px);} 75%{ transform: translateX(6px);} }
        @supports(padding: max(0px)) {.app-header, .tab-content, .nav-tabs {padding-left: max(16px, env(safe-area-inset-left));padding-right: max(16px, env(safe-area-inset-right));}.scroll-to-top {right: max(16px, env(safe-area-inset-right));bottom: max(80px, calc(80px + env(safe-area-inset-bottom)));}}
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:10000; padding:20px; }
        .modal.hidden { display: none; }
        .modal-content {background: var(--card-bg); border-radius: 20px; width: 100%; max-width: 600px; max-height: 90vh; overflow: hidden;box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: modalSlideIn 0.3s ease;}
        @keyframes modalSlideIn { from { opacity:0; transform: translateY(-50px) scale(0.9);} to { opacity:1; transform: translateY(0) scale(1);} }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid var(--border-color); background: var(--primary-color); color: white; }
        .modal-header h3 { margin:0; font-size:1.2rem; }
        .modal-close { background:none; border:none; color:white; font-size:24px; cursor:pointer; width:30px; height:30px; display:flex; align-items:center; justify-content:center; }
        .modal-body { padding:20px; max-height:60vh; overflow-y:auto; }
        .modal-actions { padding:20px; border-top:1px solid var(--border-color); display:flex; gap:10px; }
        .report-identifiers { background: rgba(99,102,241,0.05); border-radius:12px; padding:16px; margin-bottom:16px; border:2px solid var(--primary-color); }
        .identifier-item { display:flex; justify-content:space-between; margin-bottom:8px; padding:8px 0; border-bottom:1px solid var(--border-color); }
        .identifier-item:last-child { margin-bottom:0; border-bottom:none; }
        #toastContainer {position: fixed;bottom: calc(20px + var(--safe-area-inset-bottom));left: 50%;transform: translateX(-50%);z-index: 10001;display: flex;flex-direction: column;gap: 8px;pointer-events: none;max-width: 90vw;width: 400px;}
        .toast {pointer-events: all;background: var(--card-bg);color: var(--text-color);border: 1px solid var(--border-color);border-left: 4px solid var(--primary-color);border-radius: 12px;padding: 16px;box-shadow: var(--shadow-hover);opacity: 0;transform: translateY(6px);transition: all .3s ease;font-weight: 500;max-width: 100%;word-wrap: break-word;}
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast-success { border-left-color: var(--success-color); }
        .toast-info { border-left-color: var(--primary-color); }
        .toast-warning { border-left-color: var(--warning-color); }
        .save-indicator {position: fixed;top: 20px;right: 20px;background: var(--success-color);color: white;padding: 8px 16px;border-radius: 8px;font-size: 0.8rem;z-index: 10002;opacity: 0;transform: translateY(-10px);transition: all 0.3s ease;}
        .save-indicator.visible { opacity: 1; transform: translateY(0); }
        .tooltip {position: fixed;background: var(--card-bg);color: var(--text-color);padding: 12px 16px;border-radius: 8px;box-shadow: var(--shadow-hover);border: 1px solid var(--border-color);max-width: 300px;font-size: 0.8rem;line-height: 1.4;z-index: 10003;pointer-events: none;}
        .mileage-conversion {font-size: 0.75rem;color: var(--text-light);margin-top: 4px;font-style: italic;}
        @media (max-width: 480px) {#toastContainer {width: 95vw;max-width: 95vw;}.toast {padding: 14px;}}
        @keyframes errorPulse {0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }}
        .pulse {animation: errorPulse 1.5s infinite;}
        input:invalid, select:invalid {border-color: var(--danger-color) !important;}
        .required-field::after {content: " *";color: var(--danger-color);}
        .toast-close {background: none;border: none;font-size: 18px;cursor: pointer;margin-left: auto;padding: 0;width: 20px;height: 20px;display: flex;align-items: center;justify-content: center;color: var(--text-light);}
        .toast-close:hover {color: var(--text-color);}
        .inspection-item.priority-high {border-left: 4px solid var(--danger-color);}
        .inspection-item.priority-medium {border-left: 4px solid var(--warning-color);}
        .inspection-item.priority-low {border-left: 4px solid var(--success-color);}
        .priority-badge {font-size: 0.7rem;padding: 2px 6px;border-radius: 8px;font-weight: 600;}
        .priority-high { background: rgba(239, 68, 68, 0.1); color: var(--danger-color); }
        .priority-medium { background: rgba(245, 158, 11, 0.1); color: var(--warning-color); }
        .priority-low { background: rgba(16, 185, 129, 0.1); color: var(--success-color); }
        .photo-upload-section {margin-top: 16px;padding: 16px;background: rgba(99, 102, 241, 0.05);border-radius: 12px;border: 2px dashed var(--primary-color);}
        .photo-upload-label {display: block;margin-bottom: 10px;font-weight: 600;color: var(--primary-color);}
        .photo-upload-input {width: 100%;padding: 12px;border: 2px dashed var(--border-color);border-radius: 8px;background: var(--card-bg);cursor: pointer;transition: all 0.3s ease;margin-bottom: 12px;}
        .photo-upload-input:hover {border-color: var(--primary-color);background: rgba(99, 102, 241, 0.05);}
        .photo-preview-container {display: grid;grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));gap: 10px;margin-top: 12px;}
        .photo-preview-item {position: relative;border-radius: 8px;overflow: hidden;border: 2px solid var(--border-color);transition: all 0.3s ease;}
        .photo-preview-item:hover {border-color: var(--primary-color);transform: scale(1.05);}
        .photo-preview-img {width: 100%;height: 80px;object-fit: cover;display: block;}
        .photo-preview-remove {position: absolute;top: 4px;right: 4px;background: var(--danger-color);color: white;border: none;border-radius: 50%;width: 20px;height: 20px;font-size: 12px;cursor: pointer;display: flex;align-items: center;justify-content: center;}
        .photo-counter {font-size: 0.8rem;color: var(--text-light);margin-top: 8px;text-align: center;}
        .photo-storage-warning {background: rgba(245, 158, 11, 0.1);border: 1px solid var(--warning-color);border-radius: 8px;padding: 10px;margin-top: 10px;font-size: 0.8rem;color: var(--warning-color);}
        .pdf-page {width: 100%;min-height: 280mm;padding: 8mm;background: white;position: relative;page-break-after: always;box-sizing: border-box;}
        .pdf-page:last-child {page-break-after: auto;}
        .page-break {page-break-before: always;}
        @media print {.pdf-page {page-break-after: always;}.pdf-page:last-child {page-break-after: auto;}}
        .progress-overlay {position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10004; color: white;}
        .progress-overlay.hidden { display: none; }
        .photo-progress-bar {width: 80%; max-width: 300px; height: 20px; background: var(--border-color); border-radius: 10px; overflow: hidden; margin: 20px 0;}
        .photo-progress-fill {height: 100%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); width: 0%; transition: width 0.3s ease;}
    </style>
</head>
<body>
    <!-- Network Status Indicator -->
    <div class="network-status" id="networkStatus"></div>
    
    <div class="app-container">
        <header class="app-header">
            <h1>üèçÔ∏è Motopodbor.ru PRO</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥–±–æ—Ä –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤</p>
            <div class="pwa-badge" id="pwaBadge" style="display: none;">PWA</div>
        </header>
        
        <!-- Rest of your HTML content remains exactly the same -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="report"><span class="tab-icon">üìä</span><span class="tab-text">–û—Ç—á–µ—Ç</span></button>
            <button class="nav-tab" data-tab="inspections"><span class="tab-icon">üìÖ</span><span class="tab-text">–ü—Ä–æ–≤–µ—Ä–∫–∏</span></button>
            <button class="nav-tab" data-tab="database"><span class="tab-icon">üóÉÔ∏è</span><span class="tab-text">–ë–∞–∑–∞</span></button>
            <button class="nav-tab" data-tab="stats"><span class="tab-icon">üìà</span><span class="tab-text">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span></button>
            <button class="nav-tab" data-tab="settings"><span class="tab-icon">‚öôÔ∏è</span><span class="tab-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></button>
        </nav>
        
        <!-- All your existing tab content remains exactly the same -->
        <div id="report-tab" class="tab-content active">
            <!-- ... your existing report tab content ... -->
        </div>
        
        <div id="inspections-tab" class="tab-content">
            <!-- ... your existing inspections tab content ... -->
        </div>
        
        <div id="database-tab" class="tab-content">
            <!-- ... your existing database tab content ... -->
        </div>
        
        <div id="stats-tab" class="tab-content">
            <!-- ... your existing stats tab content ... -->
        </div>
        
        <div id="settings-tab" class="tab-content">
            <div class="card">
                <h2 class="section-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
                
                <!-- PWA Installation Section -->
                <div class="settings-group">
                    <div class="settings-label">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
                    <div class="settings-description">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Å–≤–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</div>
                    <button class="btn btn-success" id="installBtn" style="display: none;">üì≤ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
                    <div id="pwaStatus" class="mt-10" style="font-size: 0.8rem; color: var(--text-light);"></div>
                </div>
                
                <!-- Rest of your settings content remains the same -->
                <div class="settings-group">
                    <div class="settings-label">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</div>
                    <div class="settings-description">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
                    <div class="toggle-container">
                        <span class="toggle-label">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkTheme">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-container">
                        <span class="toggle-label">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoSave" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- ... rest of your settings ... -->
            </div>
            
            <div class="card mt-20">
                <h2 class="section-title">‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h2>
                <div class="settings-group">
                    <p><strong>–í–µ—Ä—Å–∏—è:</strong> 2.7.1 PRO FINAL PWA</p>
                    <p><strong>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:</strong> –°–µ—Ä–≥–µ–π –õ–∞–Ω–¥–∏–∫</p>
                    <p><strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong> 8 950 005-05-08</p>
                    <p><strong>–°–∞–π—Ç:</strong> motopodbor.ru</p>
                    <p><strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> <span id="appVersionDate">2024</span></p>
                    <p><strong>–†–µ–∂–∏–º:</strong> <span id="appMode">–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</span></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- All your existing modals and other elements remain the same -->
    <button class="scroll-to-top" id="scrollToTopBtn" aria-label="–ù–∞–≤–µ—Ä—Ö">‚Üë</button>
    <div id="reportModal" class="modal hidden">
        <!-- ... your existing modal content ... -->
    </div>
    <div class="save-indicator" id="saveIndicator">üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div>
    <div id="toastContainer" aria-live="polite" aria-atomic="true"></div>
    <div class="progress-overlay hidden" id="photoProgressOverlay">
        <!-- ... your existing progress overlay ... -->
    </div>

    <script>
        // Your existing app object remains exactly the same, but I'll add PWA-related methods
        const app = {
            // ... all your existing properties and methods remain exactly the same ...
            
            // Add these PWA-related methods to your existing app object
            initPWA: function() {
                // Update PWA status
                this.updatePWAStatus();
                
                // Check if app is running in standalone mode
                if (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
                    document.getElementById('appMode').textContent = '–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ';
                    document.getElementById('pwaBadge').style.display = 'block';
                    console.log('Running as installed PWA');
                }
                
                // Update network status
                this.updateNetworkStatus();
            },
            
            updatePWAStatus: function() {
                const pwaStatus = document.getElementById('pwaStatus');
                const installBtn = document.getElementById('installBtn');
                
                if (!pwaStatus) return;
                
                if (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
                    pwaStatus.textContent = '‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
                    if (installBtn) {
                        installBtn.style.display = 'none';
                        installBtn.classList.add('installed');
                    }
                } else if (deferredPrompt) {
                    pwaStatus.textContent = '–î–æ—Å—Ç—É–ø–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω';
                } else {
                    pwaStatus.textContent = '–ù–∞–∂–º–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω';
                }
            },
            
            updateNetworkStatus: function() {
                const networkStatus = document.getElementById('networkStatus');
                if (!networkStatus) return;
                
                if (navigator.onLine) {
                    networkStatus.classList.remove('offline');
                    networkStatus.title = '–û–Ω–ª–∞–π–Ω';
                } else {
                    networkStatus.classList.add('offline');
                    networkStatus.title = '–û—Ñ—Ñ–ª–∞–π–Ω';
                }
            },
            
            // Modify your existing init function to include PWA initialization
            async init() {
                try {
                    await this.initIndexedDB();
                    await this.migrateFromLocalStorage();
                    await this.loadDataFromIndexedDB();
                    
                    this.initBasicComponents();
                    this.initPWA(); // Initialize PWA features
                    
                    // Your existing service worker registration is now handled in the head
                    
                    const versionDateEl = document.getElementById('appVersionDate');
                    if (versionDateEl) versionDateEl.textContent = new Date().getFullYear();
                    
                    this.checkInspectionReminders();
                    console.log('Motopodbor.ru PRO –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å PWA –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π');
                } catch (error) {
                    console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                    this.showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.', 'warning');
                    this.initBasicComponents();
                    this.initPWA();
                }
            },
            
            // ... rest of your existing methods remain exactly the same ...
        };

        // Modify your DOMContentLoaded event listener to ensure PWA features work
        document.addEventListener('DOMContentLoaded', function() {
            try {
                app.init();
                
                // Enhanced PWA event listeners
                window.addEventListener('appinstalled', () => {
                    console.log('PWA was installed');
                    app.showToast('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
                    app.updatePWAStatus();
                    
                    // Track installation analytics
                    localStorage.setItem('pwa_installed', 'true');
                    localStorage.setItem('pwa_install_timestamp', new Date().toISOString());
                });
                
                // Update network status in real-time
                window.addEventListener('online', () => {
                    app.updateNetworkStatus();
                    // Sync any pending data when coming online
                    if (app.syncPendingData) {
                        app.syncPendingData();
                    }
                });
                
                window.addEventListener('offline', () => {
                    app.updateNetworkStatus();
                });
                
                // Your existing event listeners remain the same
                const searchReports = document.getElementById('searchReports');
                if (searchReports) {
                    searchReports.addEventListener('input', () => app.loadReportsList());
                }
                
                const searchInspections = document.getElementById('searchInspections');
                if (searchInspections) {
                    searchInspections.addEventListener('input', () => app.loadInspectionsList());
                }
                
                // ... rest of your existing DOMContentLoaded code ...
                
            } catch (e) {
                console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', e);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            }
        });

        // Enhanced install function
        function installPWA() {
            if (!deferredPrompt) {
                app.showToast('–§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ', 'warning');
                return;
            }
            
            deferredPrompt.prompt();
            
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                    app.showToast('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è...', 'success');
                    
                    // Analytics
                    localStorage.setItem('pwa_install_initiated', 'true');
                } else {
                    console.log('User dismissed the install prompt');
                    app.showToast('–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞', 'warning');
                }
                deferredPrompt = null;
                
                // Update UI
                app.updatePWAStatus();
            });
        }

        // Enhanced beforeinstallprompt handler
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installBtn = document.getElementById('installBtn');
            if (installBtn) {
                installBtn.style.display = 'block';
                installBtn.onclick = installPWA;
            }
            
            // Update status
            if (app && app.updatePWAStatus) {
                app.updatePWAStatus();
            }
            
            // Auto-show prompt for new users (after 30 seconds)
            if (!localStorage.getItem('pwa_prompt_shown')) {
                setTimeout(() => {
                    if (deferredPrompt) {
                        app.showToast(
                            '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞!', 
                            'info', 
                            5000
                        );
                        localStorage.setItem('pwa_prompt_shown', 'true');
                    }
                }, 30000);
            }
        });
    </script>
</body>
</html>
